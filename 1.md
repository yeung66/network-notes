# 1 计算机网络与因特网

## 网络核心

### 分组交换

- 各种网络应用中，端系统彼此交换**报文（message）**
- 长报文会被划分为小的数据块，称为**分组（packet）**
- 源和目的地之间，每个分组经过通信链路和分组交换机（packet switch），交换机可分为路由器和链路层交换机
- 分组以链路最大速率进行传输

#### 存储转发传输

交换机在能够开始向输出链路传播分组前必须先接收整个分组，在未接收完前，先缓存

- 路由器传输整个分组存储转发时延为$d=2L/R, L为分组长度,R为链路传输速率$
- N条链路组成的路径：$d_{端对端}=N{L\over R}$

#### 排队时延和分组丢失

- 排队时延：到达的分组需要传输到某条链路，但该链路正在传输其它分组，因而需在输出队列/缓存中等待
- 分组丢失：当到达的分组需要等待但输出缓存已满时，分组会被丢弃

#### 转发表与路由选择协议

路由器怎么决定将分组向哪条链路进行转发

- 转发表：将目的地址映射为输出链路
- 路由选择协议：如何配置转发表

### 电路交换

端系统通信期间，预留了端系统间沿路径通信所需资源（缓存，链路传输速率）

- 电路：在通信前在接发方之间建立的一条连接
- 端对端连接：网络在两台主机之间创建的一条专用连接

#### 电路复用

将一条电路当作多条使用

静默期专用电路闲置而不够经济

- 频分复用（Frequency-Division Multiplexing)：共享频谱，连接时每条连接专用一个频段
- 时分复用（Time-Division Multiplexing）
  - 时间划分为固定期间的帧，每个帧又划分为固定数量的时隙
  - 每个连接指定一个专门的时隙
  - 速率为帧速率乘以时隙的比特数量

#### 对比

- 分组交换：
  - 端对端时延可变且不可预测（排队时延），不适合实时交换
  - 更好的带宽控制
  - 更简单有效，实现成本低
  - 为什么更有效：性能效率高，时延概率低

### 网络的网络

1. 网络结构1：单一全球传输ISP互联所有接入ISP
2. 网络结构2：多个全球传输ISP，且它们互联
3. 网络结构3：增设区域ISP，接入ISP连接区域ISP，区域ISP连接第一层ISP，第一层ISP类似于全球传输ISP
4. 网络结构4
   - 存在点PoP：提供商网络中的路由器群组，客户要与提供商PoP连接，可直接从第三方链路直连PoP的路由器
   - 多宿：ISP可与多个ISP连接
   - 对等：相同等级层次的邻近一对ISP
   - 因特网交换点：多个ISP一起对等的汇合点
5. 网络结构5：在4的顶层增添内容提供商

## 时延，丢包，吞吐量

### 时延

- 处理时延：检查分组首部并决定导向何处；差错检查；微秒级别
- 排队时延：分组在链路上等待传输（队列是否为空/有无其它分组正在传输
- 传输时延：分组所有比特推向链路所需的时间$L/R$
- 传播时延：在链路的起点到终点传播所需要的时间
- 总时延：四者之和

### 排队时延和丢包

排队时延对不同的分组不同，其取决于到达队列的速率a，链路传输速率R，到达流量的性质（周期性或突发性

流量强度$La/R$，不能大于1，平均时延与流量强度的关系：下凸曲线

当分组到达时队列已满，则分组被丢弃

### 端对端时延

从源到目的地的时延，假定有N-1台路由器，网络无拥塞

$$d_{end-end}=N(d_{proc}+d_{trans}+d_{prop})$$

#### traceroute

测试端对端时延，源发送多个分组，第i个路由器收到第i个分组时，向源回送报文，报文记录了所经历时间和路由器的名字和地址

实际进行三次实验，源发送3*N个报文

### 吞吐量

一定时间段内传输的数据量

- 瞬时吞吐量
- 平均吞吐量
- 瓶颈链路：制约吞吐量的链路/最小传输速率的链路

## 协议层次及服务模型

### 分层结构

将功能划分层次，每层执行某些操作，且可调用直接下层服务

#### 优点

1. 可以讨论大而复杂系统的定义良好的特定部分
2. 提供模块化，易于改变
3. 改变某层实现不影响其它组件

### 服务模型

#### 协议分层

以分层的方式组织协议，每种功能属于某一层，向上一层提供服务

所有协议成为协议栈

#### 因特网协议栈

- 应用层：网络应用程序和他们的协议存留的地方，分布在端系统上，信息分组为报文message
- 传输层：应用程序端点之间传送应用层报文，传输的分组为报文段segment
- 网络层：将数据报datagram从一个主机移到另一个主机
- 链路层：将从网络层的数据传递给下一个节点/下一个节点上传数据到网络层，分组为帧frame
- 物理层：帧从一个网络元素移动到另一个网络元素

#### OSI模型

7层组织，在应用层与传输层之间增加表示层和会话层

- 表示层：使程序能解释交换数据的含义
- 会话层：数据交换的定界和同步功能

#### 封装

对于上一层的分组添加首部信息形成本层的分组

一个分组由两部分组成：首部字段和有效载荷字段（即上一层的分组